# æ‰«ç è·å–æ¡Œå·åŠŸèƒ½è¯´æ˜

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

ç”¨æˆ·é€šè¿‡æ‰«ææ¡Œå·äºŒç»´ç è¿›å…¥å°ç¨‹åºæ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è·å–æ¡Œå·å¹¶ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼Œæ–¹ä¾¿åç»­ç‚¹é¤ä½¿ç”¨ã€‚

---

## ğŸ”„ å®ç°åŸç†

### 1. äºŒç»´ç ç”Ÿæˆ

**äº‘å‡½æ•°**: `generateTableQRCode`

ç”Ÿæˆçš„å°ç¨‹åºç åŒ…å«åœºæ™¯å‚æ•°ï¼š
```javascript
{
  scene: `table=${tableNumber}`,
  page: 'pages/index/index'
}
```

**ç¤ºä¾‹**ï¼š
- 1å·æ¡Œçš„äºŒç»´ç ï¼š`scene=table=1`
- 2å·æ¡Œçš„äºŒç»´ç ï¼š`scene=table=2`

### 2. æ‰«ç è¿›å…¥å°ç¨‹åº

**app.js ä¸­çš„ `loadTableNumber` å‡½æ•°**ï¼š

```javascript
loadTableNumber(options) {
  let tableNumber = null
  
  // æ–¹å¼1: ä»URLå‚æ•°è·å–
  if (options && options.query && options.query.table) {
    tableNumber = options.query.table
    console.log('ä»URLå‚æ•°è·å–æ¡Œå·:', tableNumber)
  } 
  // æ–¹å¼2: ä»åœºæ™¯å‚æ•°è·å–ï¼ˆæ‰«ç è¿›å…¥ï¼‰
  else if (options && options.scene) {
    const scene = decodeURIComponent(options.scene)
    console.log('åœºæ™¯å‚æ•°:', scene)
    
    const tableMatch = scene.match(/table=([^&]+)/)
    if (tableMatch) {
      tableNumber = tableMatch[1]
      console.log('ä»åœºæ™¯å‚æ•°è·å–æ¡Œå·:', tableNumber)
    }
  }
  
  // ä¿å­˜æ¡Œå·
  if (tableNumber) {
    wx.setStorageSync('tableNumber', tableNumber)
    this.globalData.tableNumber = tableNumber
    console.log('æ¡Œå·å·²ä¿å­˜:', tableNumber)
  } else {
    this.globalData.tableNumber = wx.getStorageSync('tableNumber') || ''
    console.log('ä½¿ç”¨æœ¬åœ°å­˜å‚¨çš„æ¡Œå·:', this.globalData.tableNumber)
  }
}
```

### 3. é¡µé¢æ˜¾ç¤ºæ¡Œå·

**é¦–é¡µ (index.js)**ï¼š
```javascript
loadTableNumber() {
  const tableNumber = app.globalData.tableNumber || wx.getStorageSync('tableNumber') || ''
  this.setData({ tableNumber })
}
```

**é¦–é¡µ (index.wxml)**ï¼š
```xml
<view class="table-info-card">
  <text class="table-info-label">ğŸ“ å½“å‰æ¡Œå·</text>
  <text class="table-info-value">{{tableNumber || '0'}}</text>
</view>
```

**è´­ç‰©è½¦é¡µé¢ (cart.js)**ï¼š
```javascript
loadTableNumber() {
  const tableNumber = wx.getStorageSync('tableNumber') || ''
  this.setData({ tableNumber })
}
```

**è´­ç‰©è½¦é¡µé¢ (cart.wxml)**ï¼š
```xml
<text class="table-number">ğŸ“ æ¡Œå·ï¼š{{tableNumber || '0'}}</text>
```

---

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### æ–¹æ³•1: ä½¿ç”¨å¼€å‘è€…å·¥å…·æµ‹è¯•

1. **ç”Ÿæˆæ¡Œå·äºŒç»´ç **
   - è¿›å…¥æ¡Œå·äºŒç»´ç ç®¡ç†é¡µé¢
   - ç‚¹å‡»"ç”ŸæˆäºŒç»´ç "æŒ‰é’®
   - é€‰æ‹©æ¡Œå·ï¼ˆå¦‚ï¼š1å·æ¡Œï¼‰
   - ç­‰å¾…äºŒç»´ç ç”Ÿæˆå®Œæˆ

2. **æµ‹è¯•æ‰«ç **
   - åœ¨å¼€å‘è€…å·¥å…·ä¸­ï¼Œç‚¹å‡»"ç¼–è¯‘"
   - åœ¨"ç¼–è¯‘æ¨¡å¼"ä¸­ï¼Œé€‰æ‹©"é€šè¿‡äºŒç»´ç ç¼–è¯‘"
   - è¾“å…¥åœºæ™¯å‚æ•°ï¼š`table=1`
   - ç‚¹å‡»"ç¼–è¯‘"

3. **éªŒè¯ç»“æœ**
   - æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼š
     ```
     åœºæ™¯å‚æ•°: table=1
     ä»åœºæ™¯å‚æ•°è·å–æ¡Œå·: 1
     æ¡Œå·å·²ä¿å­˜: 1
     ```
   - æ£€æŸ¥é¦–é¡µæ˜¯å¦æ˜¾ç¤ºï¼š`ğŸ“ å½“å‰æ¡Œå· 1`
   - æ£€æŸ¥è´­ç‰©è½¦é¡µé¢æ˜¯å¦æ˜¾ç¤ºï¼š`ğŸ“ æ¡Œå·ï¼š1`

### æ–¹æ³•2: ä½¿ç”¨çœŸæœºæµ‹è¯•

1. **ç”Ÿæˆæ¡Œå·äºŒç»´ç **
   - è¿›å…¥æ¡Œå·äºŒç»´ç ç®¡ç†é¡µé¢
   - ç‚¹å‡»"ç”ŸæˆäºŒç»´ç "æŒ‰é’®
   - é€‰æ‹©æ¡Œå·ï¼ˆå¦‚ï¼š1å·æ¡Œï¼‰
   - ç­‰å¾…äºŒç»´ç ç”Ÿæˆå®Œæˆ
   - ç‚¹å‡»"ä¸‹è½½äºŒç»´ç "ä¿å­˜åˆ°æ‰‹æœº

2. **æµ‹è¯•æ‰«ç **
   - æ‰“å¼€å¾®ä¿¡ï¼Œä½¿ç”¨"æ‰«ä¸€æ‰«"åŠŸèƒ½
   - æ‰«æä¿å­˜çš„äºŒç»´ç 
   - è¿›å…¥å°ç¨‹åº

3. **éªŒè¯ç»“æœ**
   - æ£€æŸ¥é¦–é¡µæ˜¯å¦æ˜¾ç¤ºæ­£ç¡®çš„æ¡Œå·
   - æ£€æŸ¥è´­ç‰©è½¦é¡µé¢æ˜¯å¦æ˜¾ç¤ºæ­£ç¡®çš„æ¡Œå·
   - æäº¤è®¢å•æ—¶æ£€æŸ¥è®¢å•ä¸­çš„æ¡Œå·æ˜¯å¦æ­£ç¡®

### æ–¹æ³•3: æ‰‹åŠ¨æµ‹è¯•ï¼ˆæ¨¡æ‹Ÿæ‰«ç ï¼‰

åœ¨å¼€å‘è€…å·¥å…·ä¸­ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹ app.js ä¸­çš„ä»£ç æ¥æ¨¡æ‹Ÿæ‰«ç ï¼š

```javascript
// åœ¨ app.js çš„ onLaunch ä¸­ä¸´æ—¶æ·»åŠ 
onLaunch(options) {
  // æ¨¡æ‹Ÿæ‰«ç è·å–æ¡Œå·
  options = options || {}
  options.scene = 'table=1'
  
  this.loadTableNumber(options)
}
```

---

## ğŸ“Š æ•°æ®æµç¨‹

```
ç”¨æˆ·æ‰«ç 
    â†“
å¾®ä¿¡è¯†åˆ«å°ç¨‹åºç 
    â†“
å°ç¨‹åºå¯åŠ¨ï¼Œä¼ å…¥ scene å‚æ•°
    â†“
app.js çš„ onLaunch æ¥æ”¶ options
    â†“
loadTableNumber è§£æ scene å‚æ•°
    â†“
æå– tableNumberï¼ˆå¦‚ï¼š1ï¼‰
    â†“
ä¿å­˜åˆ° wx.setStorageSync('tableNumber')
    â†“
ä¿å­˜åˆ° app.globalData.tableNumber
    â†“
å„é¡µé¢ä» app.globalData æˆ–æœ¬åœ°å­˜å‚¨è¯»å–
    â†“
æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
```

---

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—

åœ¨å¼€å‘è€…å·¥å…·çš„æ§åˆ¶å°ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—ï¼š

```
åœºæ™¯å‚æ•°: table=1
ä»åœºæ™¯å‚æ•°è·å–æ¡Œå·: 1
æ¡Œå·å·²ä¿å­˜: 1
```

### 2. æ£€æŸ¥æœ¬åœ°å­˜å‚¨

åœ¨å¼€å‘è€…å·¥å…·çš„"å­˜å‚¨"é¢æ¿ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼š

```json
{
  "tableNumber": "1"
}
```

### 3. æ£€æŸ¥å…¨å±€æ•°æ®

åœ¨æ§åˆ¶å°ä¸­è¾“å…¥ï¼š

```javascript
console.log(getApp().globalData.tableNumber)
```

åº”è¯¥è¾“å‡ºï¼š`1`

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. åœºæ™¯å‚æ•°æ ¼å¼

ç¡®ä¿åœºæ™¯å‚æ•°æ ¼å¼æ­£ç¡®ï¼š
- âœ… æ­£ç¡®ï¼š`table=1`
- âœ… æ­£ç¡®ï¼š`table=10`
- âŒ é”™è¯¯ï¼š`table=1&other=value`
- âŒ é”™è¯¯ï¼š`tableNumber=1`

### 2. æ¡Œå·æ•°æ®ç±»å‹

æ¡Œå·ä»¥å­—ç¬¦ä¸²å½¢å¼å­˜å‚¨ï¼š
- âœ… æ­£ç¡®ï¼š`'1'`
- âœ… æ­£ç¡®ï¼š`'10'`
- âŒ é”™è¯¯ï¼š`1`ï¼ˆæ•°å­—ï¼‰

### 3. æœ¬åœ°å­˜å‚¨æ¸…ç†

å¦‚æœéœ€è¦æ¸…é™¤æ¡Œå·ï¼Œå¯ä»¥ï¼š

```javascript
wx.removeStorageSync('tableNumber')
```

æˆ–è€…åœ¨å¼€å‘è€…å·¥å…·çš„"å­˜å‚¨"é¢æ¿ä¸­æ‰‹åŠ¨åˆ é™¤ã€‚

---

## ğŸ¯ ç»Ÿä¸€è§„åˆ™

### æ¡Œå·è§„åˆ™
- **æœ‰æ¡Œå·**ï¼šæ˜¾ç¤ºå®é™…æ¡Œå·ï¼ˆå¦‚ï¼š1å·æ¡Œã€2å·æ¡Œ...ï¼‰
- **æ— æ¡Œå·**ï¼šæ˜¾ç¤ºé»˜è®¤æ¡Œå·0
- **æ‰«ç è·å–**ï¼šé€šè¿‡äºŒç»´ç æ‰«ç è·å–æ¡Œå·

### è®¢å•æäº¤
```javascript
const orderData = {
  tableNumber: this.data.tableNumber || '0',
  // ... å…¶ä»–å‚æ•°
}
```

---

## âœ… åŠŸèƒ½æ£€æŸ¥æ¸…å•

- [x] app.js ä¸­å®ç° loadTableNumber å‡½æ•°
- [x] æ”¯æŒä» URL å‚æ•°è·å–æ¡Œå·
- [x] æ”¯æŒä»åœºæ™¯å‚æ•°è·å–æ¡Œå·
- [x] æ¡Œå·ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
- [x] æ¡Œå·ä¿å­˜åˆ°å…¨å±€æ•°æ®
- [x] é¦–é¡µæ˜¾ç¤ºæ¡Œå·
- [x] è´­ç‰©è½¦é¡µé¢æ˜¾ç¤ºæ¡Œå·
- [x] è®¢å•æäº¤æ—¶ä½¿ç”¨æ¡Œå·
- [x] æ— æ¡Œå·æ—¶é»˜è®¤ä¸º0
- [x] æ·»åŠ æ§åˆ¶å°æ—¥å¿—ä¾¿äºè°ƒè¯•

---

## ğŸ“ æ€»ç»“

æ‰«ç è·å–æ¡Œå·åŠŸèƒ½å·²å®Œæ•´å®ç°ï¼š

1. âœ… **ç”ŸæˆäºŒç»´ç **ï¼šgenerateTableQRCode äº‘å‡½æ•°ç”ŸæˆåŒ…å«æ¡Œå·ä¿¡æ¯çš„å°ç¨‹åºç 
2. âœ… **æ‰«ç è¯†åˆ«**ï¼šapp.js çš„ loadTableNumber å‡½æ•°è§£æåœºæ™¯å‚æ•°
3. âœ… **æ•°æ®ä¿å­˜**ï¼šæ¡Œå·ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨å’Œå…¨å±€æ•°æ®
4. âœ… **é¡µé¢æ˜¾ç¤º**ï¼šé¦–é¡µå’Œè´­ç‰©è½¦é¡µé¢æ˜¾ç¤ºæ¡Œå·
5. âœ… **è®¢å•æäº¤**ï¼šè®¢å•æäº¤æ—¶ä½¿ç”¨æ¡Œå·æˆ–é»˜è®¤å€¼0

ç”¨æˆ·æ‰«ç åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è·å–å¹¶ä¿å­˜æ¡Œå·ï¼Œæ— éœ€æ‰‹åŠ¨è¾“å…¥ï¼Œæå‡äº†ç”¨æˆ·ä½“éªŒï¼
