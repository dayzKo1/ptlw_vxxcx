<view class="container">
  <view class="header-section">
    <view class="delivery-mode-switch">
      <view 
        class="mode-item {{deliveryMode === 'pickup' ? 'active' : ''}}" 
        bindtap="switchDeliveryMode" 
        data-mode="pickup"
      >
        <text class="mode-icon">ğŸƒ</text>
        <text class="mode-text">è‡ªå–</text>
      </view>
      <view 
        class="mode-item {{deliveryMode === 'delivery' ? 'active' : ''}}" 
        bindtap="switchDeliveryMode" 
        data-mode="delivery"
      >
        <text class="mode-icon">ğŸ›µ</text>
        <text class="mode-text">é…é€</text>
      </view>
    </view>
    
    <view class="search-bar">
      <view class="search-input-wrapper">
        <text class="search-icon">ğŸ”</text>
        <input 
          class="search-input" 
          placeholder="æœç´¢èœå“åç§°" 
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
          confirm-type="search"
        />
        <text class="clear-icon" wx:if="{{searchKeyword}}" bindtap="clearSearch">âœ•</text>
      </view>
    </view>
  </view>

  <view class="menu-layout" wx:if="{{!showSearchResult}}">
    <scroll-view scroll-y class="category-sidebar" scroll-into-view="{{currentCategory}}" scroll-with-animation>
      <view 
        class="category-item {{item._id === currentCategoryId ? 'active' : ''}}" 
        wx:for="{{categories}}" 
        wx:key="_id"
        bindtap="selectCategory"
        data-id="{{item._id}}"
        data-index="{{index}}"
      >
        <text class="category-emoji">{{item.emoji || 'ğŸ½ï¸'}}</text>
        <text>{{item.name}}</text>
      </view>
    </scroll-view>

    <scroll-view scroll-y class="dish-list" bindscrolltolower="loadMore">
      <view class="category-section" id="category-{{item._id}}" wx:for="{{categoryDishes}}" wx:key="_id">
        <view class="category-header">
          <text>{{item.emoji || 'ğŸ½ï¸'}} {{item.name}}</text>
        </view>
        <view class="dish-item" wx:for="{{item.dishes}}" wx:for-item="dish" wx:key="_id" bindtap="goToDetail" data-id="{{dish._id}}">
          <view class="dish-image-placeholder">{{dish.emoji || 'ğŸ½ï¸'}}</view>
          <view class="dish-info">
            <text class="dish-name">{{dish.name}}</text>
            <text class="dish-desc">{{dish.description}}</text>
            <view class="dish-tags" wx:if="{{dish.isHot || dish.isNew}}">
              <text class="dish-tag" wx:if="{{dish.isHot}}">ğŸ”¥ çƒ­é—¨</text>
              <text class="dish-tag" wx:if="{{dish.isNew}}">âœ¨ æ–°å“</text>
            </view>
            <view class="dish-bottom">
              <text class="dish-price">Â¥{{dish.price}}</text>
              <view class="quantity-control" catchtap="stopPropagation">
                <view class="minus-btn" wx:if="{{dish.quantity > 0}}" bindtap="minusDish" data-id="{{dish._id}}">-</view>
                <text class="quantity" wx:if="{{dish.quantity > 0}}">{{dish.quantity}}</text>
                <view class="plus-btn" bindtap="plusDish" data-id="{{dish._id}}">+</view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <view class="search-result" wx:if="{{showSearchResult}}">
    <view class="search-result-header">
      <text class="search-result-title">æœç´¢ç»“æœ</text>
      <text class="search-result-count">å…±{{searchResults.length}}ä¸ªå•†å“</text>
    </view>
    <scroll-view scroll-y class="search-result-list">
      <view class="dish-item" wx:for="{{searchResults}}" wx:key="_id" bindtap="goToDetail" data-id="{{item._id}}">
        <view class="dish-image-placeholder">{{item.emoji || 'ğŸ½ï¸'}}</view>
        <view class="dish-info">
          <text class="dish-name">{{item.name}}</text>
          <text class="dish-desc">{{item.description}}</text>
          <view class="dish-tags" wx:if="{{item.isHot || item.isNew}}">
            <text class="dish-tag" wx:if="{{item.isHot}}">ğŸ”¥ çƒ­é—¨</text>
            <text class="dish-tag" wx:if="{{item.isNew}}">âœ¨ æ–°å“</text>
          </view>
          <view class="dish-bottom">
            <text class="dish-price">Â¥{{item.price}}</text>
            <view class="quantity-control" catchtap="stopPropagation">
              <view class="minus-btn" wx:if="{{item.quantity > 0}}" bindtap="minusDish" data-id="{{item._id}}">-</view>
              <text class="quantity" wx:if="{{item.quantity > 0}}">{{item.quantity}}</text>
              <view class="plus-btn" bindtap="plusDish" data-id="{{item._id}}">+</view>
            </view>
          </view>
        </view>
      </view>
      <view class="empty-result" wx:if="{{searchResults.length === 0}}">
        <text class="empty-icon">ğŸ”</text>
        <text class="empty-text">æœªæ‰¾åˆ°ç›¸å…³å•†å“</text>
      </view>
    </scroll-view>
  </view>

  <view class="cart-bar" wx:if="{{cartCount > 0}}">
    <view class="cart-info" bindtap="goToCart">
      <view class="cart-icon-wrapper">
        <view class="cart-icon">ğŸ›’</view>
        <view class="cart-badge">{{cartCount}}</view>
      </view>
      <view class="cart-total">
        <text class="total-price">Â¥{{cartTotal}}</text>
        <text class="total-desc">å¦éœ€é…é€è´¹</text>
      </view>
    </view>
    <button class="checkout-btn" bindtap="goToCart">å»ç»“ç®—</button>
  </view>
</view>