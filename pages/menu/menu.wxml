<view class="container">
  <view class="header-section">
    <view class="header-top">
      <view class="shop-info" bindtap="openLocation">
        <text class="shop-name">{{shopInfo.name || 'ç¾å‘³é¤å…'}}</text>
        <view class="shop-location">
          <text class="shop-distance">{{distance || 'ç‚¹å‡»è·å–ä½ç½®'}}</text>
        </view>
      </view>
      <view class="delivery-mode-switch">
        <view 
          class="mode-item {{deliveryMode === 'pickup' ? 'active' : ''}}" 
          bindtap="switchDeliveryMode" 
          data-mode="pickup"
        >
          <text class="mode-text">è‡ªå–</text>
        </view>
        <view 
          class="mode-item {{deliveryMode === 'delivery' ? 'active' : ''}}" 
          bindtap="switchDeliveryMode" 
          data-mode="delivery"
        >
          <text class="mode-text">é…é€</text>
        </view>
      </view>
    </view>
  </view>

  <view class="menu-layout">
    <scroll-view scroll-y class="category-sidebar" scroll-into-view="category-{{currentCategoryId}}" scroll-with-animation>
      <view 
        id="category-{{item._id}}"
        class="category-item {{item._id === currentCategoryId ? 'active' : ''}}" 
        wx:for="{{categories}}" 
        wx:key="_id"
        bindtap="selectCategory"
        data-id="{{item._id}}"
        data-index="{{index}}"
      >
        <text class="category-emoji">{{item.emoji || 'ğŸ½ï¸'}}</text>
        <text>{{item.name}}</text>
      </view>
    </scroll-view>
    <scroll-view scroll-y class="dish-list" scroll-into-view="category-{{currentCategoryId}}" scroll-with-animation scroll-into-view-alignment="top">
      <view class="category-section" id="category-{{item._id}}" wx:for="{{categoryDishes}}" wx:key="_id">
        <view class="category-header">
          <text>{{item.emoji || 'ğŸ½ï¸'}} {{item.name}}</text>
        </view>
        <view class="dish-item" wx:for="{{item.dishes}}" wx:for-item="dish" wx:key="_id" bindtap="goToDetail" data-id="{{dish._id}}">
          <view class="dish-image-placeholder">{{dish.emoji || 'ğŸ½ï¸'}}</view>
          <view class="dish-info">
            <text class="dish-name">{{dish.name}}</text>
            <text class="dish-desc">{{dish.description}}</text>
            <view class="dish-tags" wx:if="{{dish.isHot || dish.isNew}}">
              <text class="dish-tag" wx:if="{{dish.isHot}}">ğŸ”¥ çƒ­é—¨</text>
              <text class="dish-tag" wx:if="{{dish.isNew}}">âœ¨ æ–°å“</text>
            </view>
            <view class="dish-bottom">
              <text class="dish-price">Â¥{{dish.price}}</text>
              <view class="quantity-control" catchtap="stopPropagation">
                <view class="minus-btn" wx:if="{{dish.quantity > 0}}" bindtap="minusDish" data-id="{{dish._id}}">-</view>
                <text class="quantity" wx:if="{{dish.quantity > 0}}">{{dish.quantity}}</text>
                <view class="plus-btn" bindtap="plusDish" data-id="{{dish._id}}">+</view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <view class="cart-bar" wx:if="{{cartCount > 0}}">
    <view class="cart-info" bindtap="toggleCartDrawer">
      <view class="cart-icon-wrapper">
        <view class="cart-icon">ğŸ›’</view>
        <view class="cart-badge">{{cartCount}}</view>
      </view>
      <view class="cart-total">
        <text class="total-price">Â¥{{cartTotal}}</text>
        <text class="total-desc">å¦éœ€é…é€è´¹</text>
      </view>
    </view>
    <button class="checkout-btn" bindtap="goToCheckout">å»ç»“ç®—</button>
  </view>

  <view class="cart-drawer-mask {{showCartDrawer ? 'show' : ''}}" bindtap="toggleCartDrawer"></view>
  <view class="cart-drawer {{showCartDrawer ? 'show' : ''}}">
    <view class="cart-drawer-header">
      <text class="cart-drawer-title">è´­ç‰©è½¦</text>
      <text class="close-drawer" bindtap="toggleCartDrawer">âœ•</text>
    </view>

    <scroll-view scroll-y class="cart-drawer-list">
      <view class="cart-drawer-item" wx:for="{{cartItems}}" wx:key="_id">
        <view class="cart-dish-image-placeholder">{{item.emoji || 'ğŸ½ï¸'}}</view>
        <view class="cart-dish-info">
          <text class="cart-dish-name">{{item.name}}</text>
          <text class="cart-dish-price">Â¥{{item.price}}</text>
        </view>
        <view class="cart-quantity-control">
          <view class="minus-btn" bindtap="minusDish" data-id="{{item._id}}">-</view>
          <text class="quantity">{{item.quantity}}</text>
          <view class="plus-btn" bindtap="plusDish" data-id="{{item._id}}">+</view>
        </view>
      </view>
      <view class="empty-cart" wx:if="{{cartItems.length === 0}}">
        <text class="empty-icon">ğŸ›’</text>
        <text class="empty-text">è´­ç‰©è½¦æ˜¯ç©ºçš„</text>
      </view>
    </scroll-view>

    <view class="cart-drawer-footer">
      <view class="drawer-total">
        <text class="drawer-total-label">åˆè®¡</text>
        <text class="drawer-total-price">Â¥{{cartTotal}}</text>
      </view>
      <button class="drawer-checkout-btn" bindtap="goToCheckout">å»ç»“ç®—</button>
    </view>
  </view>

  <view class="dish-modal-mask {{showDishModal ? 'show' : ''}}" bindtap="closeDishModal"></view>
  <view class="dish-modal {{showDishModal ? 'show' : ''}}">
    <view class="dish-modal-content">
      <view class="dish-modal-header">
        <text class="dish-modal-title">å•†å“è¯¦æƒ…</text>
        <text class="close-modal" bindtap="closeDishModal">âœ•</text>
      </view>
      
      <scroll-view scroll-y class="dish-modal-body">
        <view class="modal-dish-image">{{selectedDish.emoji || 'ğŸ½ï¸'}}</view>
        <view class="modal-dish-info">
          <text class="modal-dish-name">{{selectedDish.name}}</text>
          <text class="modal-dish-desc">{{selectedDish.description}}</text>
          <view class="modal-dish-tags" wx:if="{{selectedDish.isHot || selectedDish.isNew}}">
            <text class="modal-dish-tag" wx:if="{{selectedDish.isHot}}">ğŸ”¥ çƒ­é—¨</text>
            <text class="modal-dish-tag" wx:if="{{selectedDish.isNew}}">âœ¨ æ–°å“</text>
          </view>
          <view class="modal-dish-price">
            <text class="modal-price">Â¥{{selectedDish.price}}</text>
          </view>
        </view>
      </scroll-view>
      
      <view class="dish-modal-footer">
        <button class="modal-add-btn" bindtap="addToCartFromModal">åŠ å…¥è´­ç‰©è½¦</button>
      </view>
    </view>
  </view>
</view>